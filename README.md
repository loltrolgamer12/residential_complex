# üè¢ Sistema de Gesti√≥n de Conjuntos Residenciales# üè† Sistema Conjuntos Residenciales - Backend API



Sistema completo de gesti√≥n para conjuntos residenciales desarrollado con Node.js, Express.js y PostgreSQL. Incluye autenticaci√≥n JWT, gesti√≥n multi-rol, sistema de notificaciones autom√°ticas y m√≥dulos especializados para administraci√≥n, mantenimiento, Airbnb y m√°s.Sistema completo de gesti√≥n para conjuntos residenciales desarrollado en Node.js.



[![Node.js](https://img.shields.io/badge/Node.js-18.x-green.svg)](https://nodejs.org/)## üöÄ Caracter√≠sticas

[![Express.js](https://img.shields.io/badge/Express.js-4.21.2-blue.svg)](https://expressjs.com/)

[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-15+-blue.svg)](https://postgresql.org/)- **Gesti√≥n de Usuarios**: Administradores, propietarios, inquilinos, personal

[![JWT](https://img.shields.io/badge/JWT-Authentication-orange.svg)](https://jwt.io/)- **Administraci√≥n de Apartamentos**: Estados, contratos, informaci√≥n completa

[![Tests](https://img.shields.io/badge/Tests-25%2F25%20Passing-brightgreen.svg)](https://jestjs.io/)- **Sistema de Pagos**: Cuotas, servicios, multas con seguimiento

- **Mantenimiento**: Solicitudes, asignaciones, costos y seguimiento

## üöÄ Caracter√≠sticas Principales- **Airbnb Integration**: Gesti√≥n de hu√©spedes temporales

- **Notificaciones**: Sistema completo de alertas y comunicaciones

### üîê Sistema de Autenticaci√≥n- **Reportes de Da√±os**: Seguimiento y resoluci√≥n de incidentes

- **JWT Authentication** con tokens seguros- **Sistema de Logs**: Registro detallado de operaciones y errores

- **4 Roles de usuario**: Admin, Owner, Tenant, Security- **Respaldo Autom√°tico**: Backup programado de datos cr√≠ticos

- **Control de permisos granular** por endpoint- **Optimizaci√≥n de Rendimiento**: Compresi√≥n, cach√© y rate limiting

- **Middleware de seguridad** robusto

## üõ†Ô∏è Stack Tecnol√≥gico

### üè† Gesti√≥n de Apartamentos

- Registro y gesti√≥n de apartamentos  - **Backend**: Node.js + Express.js

- Asociaci√≥n con propietarios- **Autenticaci√≥n**: JWT (JSON Web Tokens)

- Estados: ocupado, alquilado, disponible- **Seguridad**: bcrypt, Helmet, CORS, Rate Limiting

- Informaci√≥n detallada por unidad- **Logging**: Winston para logs estructurados

- **Environment**: dotenv para m√∫ltiples entornos

### ‚úàÔ∏è Sistema Airbnb Integrado- **Monitoreo**: PM2 para gesti√≥n de procesos

- Registro de hu√©spedes con validaci√≥n- **Optimizaci√≥n**: Compression, Cache-Control

- **Check-in autom√°tico** por porter√≠a- **Testing**: Jest para pruebas unitarias e integraci√≥n

- **Notificaciones autom√°ticas** a propietarios y administraci√≥n

- Control de hu√©spedes activos## üì¶ Instalaci√≥n y Configuraci√≥n

- Gesti√≥n de fechas de estad√≠a

### Prerrequisitos

### üîß Sistema de Mantenimiento- Node.js 16+

- Programaci√≥n de mantenimientos- npm o yarn

- **Notificaci√≥n masiva** a todos los residentes- PM2 (para producci√≥n)

- Control de estados: pendiente, en progreso, completado

- Gesti√≥n por √°reas: piscina, gimnasio, zonas comunes### Desarrollo



### ‚ö†Ô∏è Reportes de Da√±os```bash

- Reporte de da√±os por inquilinos# 1. Clonar repositorio

- **Notificaci√≥n autom√°tica** al propietariogit clone https://github.com/loltrolgamer12/residential_complex.git

- Seguimiento de estadoscd residential_complex

- Historial de reportes por usuario

# 2. Instalar dependencias

### üì¨ Sistema de Notificacionesnpm install

- **Notificaciones autom√°ticas** del sistema

- Notificaciones manuales por administraci√≥n# 3. Configurar variables de entorno

- Tipos: Airbnb, mantenimiento, pagos, generalcp .env.example .env

- Estado de lectura y gesti√≥n por usuario# Editar .env con tus configuraciones



### üí∞ Gesti√≥n de Pagos# 4. Ejecutar en desarrollo

- Registro de cuotas de administraci√≥nnpm run dev

- Control de pagos y fechas de vencimiento```

- Estados: pendiente, pagado, vencido

- Historial de pagos por apartamento### Producci√≥n



## üõ†Ô∏è Stack Tecnol√≥gico```bash

# 1. Configurar entorno de producci√≥n

```cp .env.example .env.production

Backend:     Node.js 18.x + Express.js 4.21.2# Editar .env.production con configuraciones de producci√≥n

Database:    PostgreSQL 15+ con Sequelize ORM 6.37.7

Auth:        JWT (jsonwebtoken 9.0.2) + bcrypt# 2. Instalar PM2 globalmente

Testing:     Jest 29.7.0 + Supertestnpm install -g pm2

Deploy:      PM2 6.0.10 con Ecosystem

Security:    Helmet, CORS, Rate Limiting, Input Validation# 3. Construir para producci√≥n

Logging:     Winston 3.17.0npm run build

Docs:        Swagger/OpenAPI 3.0

```# 4. Iniciar con PM2

npm run start:prod

## üìã Requisitos del Sistema```



- **Node.js** 18.x o superior## üîß Configuraci√≥n

- **PostgreSQL** 15 o superior

- **NPM** 8.x o superior### Variables de Entorno

- **PM2** (para producci√≥n)

```env

## ‚ö° Instalaci√≥n R√°pida# Configuraci√≥n del Servidor

PORT=3000

### 1. Clonar el RepositorioNODE_ENV=development # o production

```bashLOG_LEVEL=debug # o info en producci√≥n

git clone https://github.com/loltrolgamer12/residential_complex.git

cd residential_complex# JWT y Seguridad

```JWT_SECRET=your-secret-key

JWT_EXPIRES_IN=24h

### 2. Instalar DependenciasBCRYPT_ROUNDS=12

```bashCORS_ORIGIN=http://localhost:3000

npm install

```# L√≠mites y Cach√©

RATE_LIMIT_WINDOW=900000

### 3. Configurar Base de DatosRATE_LIMIT_MAX=100

```bashCACHE_DURATION=86400000

# Crear base de datos PostgreSQL

createdb residential_complex# Backup

BACKUP_ENABLED=true

# Ejecutar scripts de inicializaci√≥nBACKUP_INTERVAL=86400000

cd databaseBACKUP_RETENTION_DAYS=7

psql -d residential_complex -f init.sql```

psql -d residential_complex -f sample_data.sql

cd ..## üìö API Endpoints

```

### Health Check

### 4. Configurar Variables de Entorno- `GET /health` - Verificar estado del servidor

```bash

cp .env.example .env### Autenticaci√≥n

# Editar .env con tus configuraciones- `POST /api/auth/login` - Iniciar sesi√≥n

```- `POST /api/auth/register` - Registrar usuario



### 5. Ejecutar el Sistema### Usuarios

```bash- `GET /api/users` - Listar usuarios

# Desarrollo- `GET /api/users/:id` - Obtener usuario espec√≠fico

npm run dev- `PUT /api/users/:id` - Actualizar usuario

- `DELETE /api/users/:id` - Eliminar usuario

# Producci√≥n

npm start### Apartamentos

```- `GET /api/apartments` - Listar apartamentos

- `POST /api/apartments` - Crear apartamento

## üîß Configuraci√≥n Detallada- `PUT /api/apartments/:id` - Actualizar apartamento

- `PUT /api/apartments/:id/status` - Cambiar estado

### Variables de Entorno (.env)

```env### Pagos

# Servidor- `GET /api/payments` - Listar pagos

PORT=3000- `POST /api/payments` - Crear pago

NODE_ENV=development- `PUT /api/payments/:id/paid` - Marcar como pagado



# Base de Datos### Mantenimiento

DB_HOST=localhost- `GET /api/maintenance/requests` - Listar solicitudes

DB_PORT=5432- `POST /api/maintenance/requests` - Crear solicitud

DB_NAME=residential_complex- `PUT /api/maintenance/requests/:id` - Actualizar solicitud

DB_USER=tu_usuario

DB_PASSWORD=tu_password## üîç Logs y Monitoreo



# JWTEl sistema incluye logs estructurados usando Winston:

JWT_SECRET=tu_jwt_secret_muy_seguro- Logs de acceso y errores

JWT_EXPIRES_IN=24h- Rotaci√≥n autom√°tica de logs

- Niveles diferentes para desarrollo y producci√≥n

# Rate Limiting- Monitoreo de recursos con PM2

RATE_LIMIT_WINDOW_MS=900000

RATE_LIMIT_MAX_REQUESTS=100## üíæ Sistema de Respaldo



# CORSBackup autom√°tico de datos cr√≠ticos:

CORS_ORIGIN=http://localhost:3000- Programaci√≥n configurable

```- Retenci√≥n personalizable

- Compresi√≥n de backups

### Configuraci√≥n de Base de Datos- Logs de operaciones de respaldo

```javascript

// config/database.js## ‚ö° Optimizaciones

module.exports = {

  development: {- Compresi√≥n gzip/deflate

    username: process.env.DB_USER,- Rate limiting por IP

    password: process.env.DB_PASSWORD,- Cach√© de respuestas

    database: process.env.DB_NAME,- Validaci√≥n de datos

    host: process.env.DB_HOST,- Headers de seguridad

    port: process.env.DB_PORT,- CORS configurado

    dialect: 'postgres',

    logging: console.log## üõ°Ô∏è Seguridad

  },

  production: {- JWT para autenticaci√≥n

    use_env_variable: 'DATABASE_URL',- Encriptaci√≥n de contrase√±as con bcrypt

    dialect: 'postgres',- Headers de seguridad con Helmet

    logging: false,- Rate limiting contra ataques DoS

    ssl: true,- Validaci√≥n de datos de entrada

    dialectOptions: {- CORS configurable

      ssl: {

        require: true,## üìú Scripts

        rejectUnauthorized: false

      }- `npm run dev` - Desarrollo con hot-reload

    }- `npm run build` - Construir para producci√≥n

  }- `npm run start:prod` - Iniciar en producci√≥n con PM2

};- `npm run backup` - Ejecutar backup manual

```- `npm test` - Ejecutar tests

- `npm run lint` - Verificar c√≥digo

## üîê Sistema de Autenticaci√≥n

## üë• Contribuci√≥n

### Roles de Usuario

1. Fork el repositorio

| Rol | Permisos | Funcionalidades |2. Crea una rama para tu feature (`git checkout -b feature/AmazingFeature`)

|-----|----------|-----------------|3. Commit tus cambios (`git commit -m 'Add: AmazingFeature'`)

| **Admin** | Completos | Todas las funciones del sistema |4. Push a la rama (`git push origin feature/AmazingFeature`)

| **Owner** | Gesti√≥n de apartamentos | Airbnb, apartamentos, consultas |5. Abre un Pull Request

| **Tenant** | B√°sicos | Reportes de da√±os, consultas |

| **Security** | Control de acceso | Check-in Airbnb, consulta hu√©spedes |## üìÑ Licencia



### Endpoints de Autenticaci√≥nEste proyecto est√° bajo la Licencia MIT - ver el archivo [LICENSE.md](LICENSE.md) para detalles

- `POST /api/maintenance/requests` - Crear solicitud

#### Registro- `PUT /api/maintenance/requests/:id/status` - Actualizar estado

```http

POST /api/auth/register## üß™ Testing

Content-Type: application/json

```bash

{# Ejecutar servidor de desarrollo

  "name": "Juan P√©rez",npm run dev

  "email": "juan@example.com",

  "password": "Password123!",# Test endpoints b√°sicos

  "cedula": "12345678",curl http://localhost:3000/health

  "phone": "+57 300 123 4567",curl http://localhost:3000/api/test

  "role": "tenant"```

}

```## üìñ Documentaci√≥n



#### Login### Usuarios de Prueba

```http

POST /api/auth/login```json

Content-Type: application/json{

    "admin": {

{        "email": "admin@complejo.com",

  "email": "juan@example.com",        "password": "123456"

  "password": "Password123!"    },

}    "owner": {

```        "email": "juan.perez@email.com", 

        "password": "123456"

#### Respuesta de Autenticaci√≥n    }

```json}

{```

  "success": true,

  "message": "Login exitoso",## üîê Seguridad

  "data": {

    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",- Autenticaci√≥n JWT obligatoria

    "user": {- Validaci√≥n de roles y permisos

      "id": 1,- Sanitizaci√≥n de entrada de datos

      "name": "Juan P√©rez",- Rate limiting implementado

      "email": "juan@example.com",- Logs de auditor√≠a completos

      "role": "tenant",

      "isActive": true## üìÅ Estructura del Proyecto

    }

  }```

}residential_complex/

```‚îú‚îÄ‚îÄ config/              # Configuraciones

‚îú‚îÄ‚îÄ src/

## üì° API Endpoints‚îÇ   ‚îú‚îÄ‚îÄ domain/          # Entidades de negocio

‚îÇ   ‚îú‚îÄ‚îÄ application/     # Casos de uso

### üîë Autenticaci√≥n‚îÇ   ‚îú‚îÄ‚îÄ infrastructure/  # Capa de infraestructura

- `POST /api/auth/register` - Registrar usuario‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ web/         # Rutas, controladores, middleware

- `POST /api/auth/login` - Iniciar sesi√≥n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database/    # Conexiones y repositorios

- `GET /api/auth/profile` - Obtener perfil (requiere token)‚îÇ   ‚îî‚îÄ‚îÄ shared/          # Utilidades compartidas

‚îú‚îÄ‚îÄ docs/                # Documentaci√≥n

### üè† Apartamentos‚îú‚îÄ‚îÄ tests/               # Pruebas

- `GET /api/apartments` - Listar apartamentos‚îî‚îÄ‚îÄ package.json

- `POST /api/apartments` - Registrar apartamento (Owner/Admin)```

- `GET /api/apartments/:id` - Obtener apartamento espec√≠fico

## ü§ù Contribuci√≥n

### ‚úàÔ∏è Sistema Airbnb

- `POST /api/airbnb/guests` - Registrar hu√©sped (Owner/Admin)Este es un proyecto universitario. Para contribuir:

- `GET /api/airbnb/guests/active` - Hu√©spedes activos (Security/Admin)

- `PUT /api/airbnb/guests/:id/checkin` - Check-in (Security/Admin)1. Fork el proyecto

- `PUT /api/airbnb/guests/:id/checkout` - Check-out (Security/Admin)2. Crear rama feature (`git checkout -b feature/nueva-funcionalidad`)

3. Commit cambios (`git commit -m 'Agregar nueva funcionalidad'`)

### üîß Mantenimiento4. Push a la rama (`git push origin feature/nueva-funcionalidad`)

- `GET /api/maintenance` - Listar mantenimientos5. Crear Pull Request

- `POST /api/maintenance` - Crear mantenimiento (Admin)

- `PUT /api/maintenance/:id/status` - Actualizar estado (Admin)## üìÑ Licencia



### ‚ö†Ô∏è Reportes de Da√±osProyecto acad√©mico - Universidad Surcolombiana

- `GET /api/damage-reports` - Listar reportes (Admin)

- `POST /api/damage-reports` - Crear reporte (autenticado)## üë®‚Äçüíª Desarrollador

- `GET /api/damage-reports/my-reports` - Mis reportes (autenticado)

- **GitHub**: [@loltrolgamer12](https://github.com/loltrolgamer12)

### üì¨ Notificaciones- **Proyecto**: Sistema de Conjuntos Residenciales

- `GET /api/notifications` - Mis notificaciones (autenticado)- **Universidad**: Surcolombiana

- `POST /api/notifications` - Enviar notificaci√≥n (Admin)

- `PUT /api/notifications/:id/read` - Marcar como le√≠da---



### üí∞ Pagos‚≠ê Si este proyecto te parece √∫til, ¬°dale una estrella!

- `GET /api/payments` - Listar pagos (autenticado)
- `POST /api/payments` - Registrar pago (Admin)
- `PUT /api/payments/:id/pay` - Marcar como pagado (autenticado)

### üë• Usuarios
- `GET /api/users` - Listar usuarios (Admin)
- `PUT /api/users/:id` - Actualizar usuario (Admin/propio)
- `DELETE /api/users/:id` - Eliminar usuario (Admin)

## üîê Uso con Autenticaci√≥n

### Headers Requeridos
```javascript
// Para endpoints protegidos
headers: {
  'Authorization': 'Bearer ' + token,
  'Content-Type': 'application/json'
}
```

### Ejemplo con cURL
```bash
# Obtener token
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@test.com","password":"Admin123!"}'

# Usar token en requests
curl -X GET http://localhost:3000/api/apartments \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

### Ejemplo con JavaScript/Fetch
```javascript
// Login y obtener token
const loginResponse = await fetch('/api/auth/login', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    email: 'admin@test.com',
    password: 'Admin123!'
  })
});

const { data } = await loginResponse.json();
const token = data.token;

// Usar token para requests protegidos
const apartmentsResponse = await fetch('/api/apartments', {
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  }
});

const apartments = await apartmentsResponse.json();
```

## üß™ Testing

### Ejecutar Pruebas
```bash
# Todas las pruebas
npm test

# Pruebas espec√≠ficas
npm run test:auth
npm run test:endpoints
npm run test:functional
npm run test:token

# Pruebas con cobertura
npm run test:coverage
```

### Resultados de Pruebas
```
‚úÖ 25/25 pruebas de autenticaci√≥n con token
‚úÖ 23/23 pruebas de endpoints completas
‚úÖ 22/23 pruebas funcionales del sistema
‚úÖ 95.7% de tasa de √©xito general
```

## üöÄ Despliegue

### Desarrollo
```bash
npm run dev
```

### Producci√≥n con PM2
```bash
# Instalar PM2 globalmente
npm install -g pm2

# Iniciar con PM2
pm2 start ecosystem.config.js

# Comandos PM2
pm2 status
pm2 logs residential-complex
pm2 restart residential-complex
pm2 stop residential-complex
```

### Docker (Opcional)
```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
EXPOSE 3000
CMD ["npm", "start"]
```

## üìä Monitoreo y Logs

### Winston Logging
```javascript
// Los logs se guardan en:
logs/app.log        // Logs generales
logs/error.log      // Solo errores
logs/access.log     // Logs de acceso HTTP
```

### Health Check
```bash
# Verificar estado del servidor
curl http://localhost:3000/health

# Respuesta esperada
{
  "status": "OK",
  "timestamp": "2025-09-16T02:14:52.123Z",
  "uptime": "1h 23m 45s",
  "version": "1.0.0"
}
```

## üìö Documentaci√≥n Adicional

- **API Documentation**: `/api-docs` (Swagger UI)
- **Validaci√≥n del Sistema**: `VALIDATION_REPORT.md`
- **Pruebas con Token**: `TOKEN_VALIDATION_REPORT.md`
- **Arquitectura**: `docs/ARCHITECTURE.md`

## ü§ù Contribuir

1. Fork el proyecto
2. Crear branch para feature (`git checkout -b feature/nueva-funcionalidad`)
3. Commit los cambios (`git commit -am 'Agregar nueva funcionalidad'`)
4. Push al branch (`git push origin feature/nueva-funcionalidad`)
5. Crear Pull Request

## üìù Licencia

Este proyecto est√° bajo la Licencia MIT - ver el archivo `LICENSE` para detalles.

## üë®‚Äçüíª Autor

- **GitHub**: [@loltrolgamer12](https://github.com/loltrolgamer12)
- **Proyecto**: Sistema de Conjuntos Residenciales
- **Universidad**: Surcolombiana

Desarrollado con ‚ù§Ô∏è para la gesti√≥n eficiente de conjuntos residenciales.

---

## üÜò Soporte

¬øTienes preguntas o necesitas ayuda?

- **Issues**: [GitHub Issues](https://github.com/loltrolgamer12/residential_complex/issues)
- **Wiki**: [Documentaci√≥n completa](https://github.com/loltrolgamer12/residential_complex/wiki)
- **Email**: soporte@residentialcomplex.com

## üîÑ Changelog

### v1.0.0 (2025-09-16)
- ‚úÖ Sistema completo de autenticaci√≥n JWT
- ‚úÖ Gesti√≥n de apartamentos y usuarios
- ‚úÖ Sistema Airbnb con notificaciones autom√°ticas
- ‚úÖ Mantenimiento con notificaci√≥n masiva
- ‚úÖ Reportes de da√±os con notificaci√≥n autom√°tica
- ‚úÖ Sistema de pagos y administraci√≥n
- ‚úÖ 25 pruebas automatizadas exitosas
- ‚úÖ Documentaci√≥n completa
- ‚úÖ Configuraci√≥n de producci√≥n con PM2

---

‚≠ê Si este proyecto te parece √∫til, ¬°dale una estrella!